<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>심부름 상세 정보</title>
</head>
<body>

    <a href="{{ request.META.HTTP_REFERER }}">뒤로가기</a>
    
    <h2>심부름 상세 정보</h2>

    <div>
        물품: {{errand.item}}
        <br>
        주소: {{errand.address_1}}
        <br>
        진행 상황: {{errand.get_status_display}}
    </div>

    <div>
        나의 보유 포인트: <div id="point">{{point}}</div>
    </div>

    {% if errand.get_status_display == '수락 대기' %}
        <form method="post" id="errandForm" action="{% url 'accept_errand' errand.id %}">
            {% csrf_token %}
            <button type="button" onclick="showConfirmation()">수락</button>
        </form>
    {% endif %}

    <div id="confirmationPopup" style="display: none;">
        <p>수락하면 100포인트가 소모됩니다. 수락하시겠습니까?</p>
        <button type="button" onclick="submitForm()">확인</button>
        <button type="button" onclick="hideConfirmation()">취소</button>
    </div>

    <div id="rejectionPopup" style="display: none;">
        <p>포인트가 부족합니다.</p>
        <button type="button" onclick="hideRejection()">확인</button>
    </div>

</body>
</html>

<script>
    var point = Number(document.getElementById('point').innerHTML);

    function showConfirmation() {
        if (point >= 100) {
            document.getElementById('confirmationPopup').style.display = 'block';
        }
        else {
            document.getElementById('rejectionPopup').style.display = 'block';
        }
    }

    function hideConfirmation() {
        document.getElementById('confirmationPopup').style.display = 'none';
    }

    function hideRejection() {
        document.getElementById('rejectionPopup').style.display = 'none';
    }

    function submitForm() {
        document.getElementById('errandForm').submit();
    }
</script>